C----------------------------------------
       DOUBLE PRECISION FUNCTION DGAMMA(Z)
       
       REAL*8 X, Y, Z, A, B, FUNC
       EXTERNAL FUNC
       A = 1.0D0
       N = 64
       B = Z
       CALL QG(N, A, B, FUNC, Y)
       DGAMMA = EXP(Y)
       END
C----------------------------------------
       FUNCTION FUNC(X)
       REAL*8 FUNC, X
          CALL PSI(X,FUNC)
       END
C ----------------------------------------------------------------------
      SUBROUTINE PSI (X, Y)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
C ----------------------------------------------------------------------
C PURPOSE
C     COMPUTES THE PSI-FUNCTION, DEFINED AS THE LOGARITHMIC DERIVATIVE
C     OF THE GAMMA FUNCTION, I.E.
C         PSI(X) = (D GAMMA(X) / DX ) / GAMMA(X) = D( LN GAMMA(X) ) / DX
C METHOD
C     THE PRESENT ROUTINE IS BASED ON THE CORRESPONDING CDC-ROUTINE IN
C     'FUNPACK' (1). RATIONAL CHEBYSHEV APPROXIMATIONS ARE USED (2).
C
C DESCRIPTION OF ARGUMENTS                         (IN=INPUT,OUT=OUTPUT)
C  X      IN   GIVEN ARGUMENT. X MUST BE DIFFERENT FROM 0, -1, -2, ...
C  Y      OUT  RESULTING VALUE OF PSI FUNCTION
C
C REFERENCES
C     (1) W.J.CODY, THE FUNPACK PACKAGE OF SPECIAL FUNCTION SUBROUTINES,
C         ACM TRANSACTIONS ON MATHEMATICAL SOFTWARE VOL1 NO.1(1975)13-25
C     (2) W.J.CODY ET AL., MATH.COMP. 27, 123-127 (1973).
C
C *********** E N D  O F  D E S C R I P T I O N  F I E L D *************
C
C PRIVATE ARRAYS
      DIMENSION P1(7), P2(4), Q1(6), Q2(4)
C X01 + X02 = ZERO OF PSI TO EXTENDED PRECISION
      DATA X01/ 1.46163213253021D+00/, X02/ 1.24381499389189D-08/
C PI
      DATA PI/ 3.14159265358979D+00/
C COEFFICIENTS FOR RATIONAL APPROXIMATION OF
C PSI(X) / (X - X0),  0.5 .LE. X .LE. 3.0
      DATA P1/ 8.95385022981970D-03, 4.77762828042628D+00,
     1         1.42441585084029D+02, 1.18645200713426D+03,
     2         3.63351846806498D+03, 4.13810161269014D+03,
     3         1.30560269827897D+03/
      DATA Q1/ 4.48452573429827D+01, 5.20752771467163D+02,
     1         2.21000799247829D+03, 3.64127349079380D+03,
     2         1.90831076596300D+03, 6.91091682714532D-06/
C COEFFICIENTS FOR RATIONAL APPROXIMATION OF
C PSI(X) - LN(X) + 1 / (2*X),  X .GT. 3.0
      DATA P2/-2.12940445131011D+00,-7.01677227766760D+00,
     1        -4.48616543918018D+00,-6.48157123766197D-01/
      DATA Q2/ 3.22703493791144D+01, 8.92920700481864D+01,
     1         5.46117738103214D+01, 7.77788548522960D+00/
C
      Z = X
C
      IF (X .LT. 0.5D0) THEN
C        X.LT..5, USE REFLECTION RULE PSI(1-Z) = PSI(Z) + PI*COTAN(PI*Z)
         AUG = -PI / TAN(PI*Z)
         Z = 1 - Z
      ELSE
C        Z .GE. 0.5
         AUG = 0
      ENDIF
C
      IF (Z .LE. 3) THEN
C        0.5 .LE. Z .LE. 3.0
         DEN = Z
         UPPER = P1(1) * Z
         DO 210, I = 1, 5
         DEN = (DEN + Q1(I)) * Z
  210    UPPER = (UPPER + P1(I+1)) * Z
         DEN = (UPPER + P1(7)) / (DEN + Q1(6))
         Y = DEN * ((Z-X01) - X02) + AUG
      ELSE
C        Z .GT. 3.0
         W = 1 / (Z * Z)
         DEN = W
         UPPER = P2(1) * W
         DO 310, I = 1, 3
         DEN = (DEN + Q2(I)) * W
  310    UPPER = (UPPER + P2(I+1)) * W
         AUG = UPPER / (DEN + Q2(4)) - 1 / (2*Z) + AUG
         Y = AUG + LOG(Z)
      ENDIF
C ---------- LAST CARD OF PSI ---------
      END
C************************************************************************
      SUBROUTINE QG (N, A, B, F, Y)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      EXTERNAL F
C ----------------------------------------------------------------------
C ***********       COPYRIGHT RISOE NATIONAL LABORATORY      ***********
C ***********       RISOE COMPUTER LIBRARY     OCT 1984      ***********
C ----------------------------------------------------------------------
C PURPOSE
C     COMPUTES  Y = INTEGRAL( F(X), SUMMED OVER X FROM A TO B)
C
C METHOD
C     EVALUATION IS DONE BY MEANS OF N-POINT GAUSS-LEGENDRE QUADRATURE.
C     THIS IS EXACT WHEN F(X) IS A POLYNOMIAL OF DEGREE UP TO 2*N-1.
C     THE GAUSSIAN CONSTANTS WERE COMPUTED FROM A RECIPE IN (1) AND ARE
C     STORED INTERNALLY IN THE ROUTINE FOR A SELECTED SET OF N-VALUES.
C
C DESCRIPTION OF ARGUMENTS                         (IN=INPUT,OUT=OUTPUT)
C  N      IN   ORDER OF QUADRATURE RULE. ALLOWED VALUES OF N ARE:
C              2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 16, 24, 32, 48, 64.
C              NO RESULT IN CASE OF ILLEGAL N.
C  A      IN   THE LOWER BOUND OF THE INTERVAL.
C  B      IN   THE UPPER BOUND OF THE INTERVAL. THE CODE WORKS CORRECTLY
C              EVEN WHEN A IS NOT LESS THAN B.
C  F           THE NAME OF AN EXTERNAL FUNCTION SUBPROGRAM DEFINING THE
C              FUNCTION F(X).
C  Y      OUT  THE RESULTING INTEGRAL.
C
C EXAMPLE OF USE
C                   EXTERNAL FUNC
C                   CALL QG (8, 1., 2., FUNC, RESULT)
C                   ...
C                   END
C                   FUNCTION FUNC(X)
C                   FUNC = 1 / X
C                   END
C
C REFERENCES
C     (1) A.H.STROUD AND DON SECREST, GAUSSIAN QUADRATURE FORMULAS.
C         PRENTICE-HALL (1966).
C     (2) C.-E. FROEBERG, LAEROBOK I NUMERISK ANALYS (BONNIERS, STOCK-
C         HOLM,1967).
C
C *********** E N D  O F  D E S C R I P T I O N  F I E L D *************
C
C PRIVATE ARRAYS
      DIMENSION NP(64), GP(127), GW(127)
C GAUSS-POINTS FOR ALL ALLOWED N ARE STORED CONSECUTIVELY IN ARRAY GP.
C SIMILARLY, GAUSS-WEIGHTS ARE STORED IN ARRAY GW. THE ARRAY NP CONTAINS
C THE STARTING ADRESSES IN GP AND GW FOR EACH N.
C
      DATA NP /0, 1, 2, 4, 6, 9, 12, 16, 20, 25, 0, 30, 3*0, 36, 7*0
     1, 44, 7*0, 56, 15*0, 72, 15*0, 96/
C
      DATA (GP(I), I=1,57)/
     *  5.7735026918963D-01, 7.7459666924148D-01, 0.                 ,
     *  8.6113631159405D-01, 3.3998104358486D-01, 9.0617984593866D-01,
     *  5.3846931010568D-01, 0.                 , 9.3246951420315D-01,
     *  6.6120938646626D-01, 2.3861918608320D-01, 9.4910791234276D-01,
     *  7.4153118559939D-01, 4.0584515137740D-01, 0.                 ,
     *  9.6028985649754D-01, 7.9666647741363D-01, 5.2553240991633D-01,
     *  1.8343464249565D-01, 9.6816023950763D-01, 8.3603110732664D-01,
     *  6.1337143270059D-01, 3.2425342340381D-01, 0.                 ,
     *  9.7390652851717D-01, 8.6506336668898D-01, 6.7940956829902D-01,
     *  4.3339539412925D-01, 1.4887433898163D-01, 9.8156063424672D-01,
     *  9.0411725637047D-01, 7.6990267419430D-01, 5.8731795428662D-01,
     *  3.6783149899818D-01, 1.2523340851147D-01, 9.8940093499165D-01,
     *  9.4457502307323D-01, 8.6563120238783D-01, 7.5540440835500D-01,
     *  6.1787624440264D-01, 4.5801677765723D-01, 2.8160355077926D-01,
     *  9.5012509837637D-02, 9.9518721999702D-01, 9.7472855597131D-01,
     *  9.3827455200273D-01, 8.8641552700440D-01, 8.2000198597390D-01,
     *  7.4012419157855D-01, 6.4809365193698D-01, 5.4542147138884D-01,
     *  4.3379350762605D-01, 3.1504267969616D-01, 1.9111886747362D-01,
     *  6.4056892862606D-02, 9.9726386184948D-01, 9.8561151154527D-01/
      DATA (GP(I), I=58,114)/
     *  9.6476225558751D-01, 9.3490607593774D-01, 8.9632115576605D-01,
     *  8.4936761373257D-01, 7.9448379596794D-01, 7.3218211874029D-01,
     *  6.6304426693022D-01, 5.8771575724076D-01, 5.0689990893223D-01,
     *  4.2135127613064D-01, 3.3186860228213D-01, 2.3928736225214D-01,
     *  1.4447196158280D-01, 4.8307665687738D-02, 9.9877100725243D-01,
     *  9.9353017226635D-01, 9.8412458372283D-01, 9.7059159254625D-01,
     *  9.5298770316043D-01, 9.3138669070655D-01, 9.0587913671557D-01,
     *  8.7657202027425D-01, 8.4358826162439D-01, 8.0706620402944D-01,
     *  7.6715903251574D-01, 7.2403413092381D-01, 6.7787237963266D-01,
     *  6.2886739677651D-01, 5.7722472608397D-01, 5.2316097472223D-01,
     *  4.6690290475096D-01, 4.0868648199072D-01, 3.4875588629216D-01,
     *  2.8736248735546D-01, 2.2476379039469D-01, 1.6122235606889D-01,
     *  9.7004699209463D-02, 3.2380170962869D-02, 9.9930504173577D-01,
     *  9.9634011677196D-01, 9.9101337147674D-01, 9.8333625388463D-01,
     *  9.7332682778991D-01, 9.6100879965205D-01, 9.4641137485840D-01,
     *  9.2956917213194D-01, 9.1052213707850D-01, 8.8931544599511D-01,
     *  8.6599939815409D-01, 8.4062929625258D-01, 8.1326531512280D-01,
     *  7.8397235894334D-01, 7.5281990726053D-01, 7.1988185017161D-01,
     *  6.8523631305423D-01, 6.4896547125466D-01, 6.1115535517239D-01/
      DATA (GP(I), I=115,127)/
     *  5.7189564620263D-01, 5.3127946401989D-01, 4.8940314570705D-01,
     *  4.4636601725346D-01, 4.0227015796399D-01, 3.5722015833767D-01,
     *  3.1132287199021D-01, 2.6468716220877D-01, 2.1742364374001D-01,
     *  1.6964442042399D-01, 1.2146281929612D-01, 7.2993121787799D-02,
     *  2.4350292663424D-02/
C
      DATA (GW(I), I=1,57)/
     *  1.0000000000000D+00, 5.5555555555556D-01, 8.8888888888889D-01,
     *  3.4785484513745D-01, 6.5214515486255D-01, 2.3692688505619D-01,
     *  4.7862867049937D-01, 5.6888888888889D-01, 1.7132449237917D-01,
     *  3.6076157304814D-01, 4.6791393457269D-01, 1.2948496616887D-01,
     *  2.7970539148928D-01, 3.8183005050512D-01, 4.1795918367347D-01,
     *  1.0122853629038D-01, 2.2238103445337D-01, 3.1370664587789D-01,
     *  3.6268378337836D-01, 8.1274388361574D-02, 1.8064816069486D-01,
     *  2.6061069640294D-01, 3.1234707704000D-01, 3.3023935500126D-01,
     *  6.6671344308688D-02, 1.4945134915058D-01, 2.1908636251598D-01,
     *  2.6926671931000D-01, 2.9552422471475D-01, 4.7175336386512D-02,
     *  1.0693932599532D-01, 1.6007832854335D-01, 2.0316742672307D-01,
     *  2.3349253653835D-01, 2.4914704581340D-01, 2.7152459411754D-02,
     *  6.2253523938648D-02, 9.5158511682493D-02, 1.2462897125553D-01,
     *  1.4959598881658D-01, 1.6915651939500D-01, 1.8260341504492D-01,
     *  1.8945061045507D-01, 1.2341229799987D-02, 2.8531388628934D-02,
     *  4.4277438817420D-02, 5.9298584915437D-02, 7.3346481411080D-02,
     *  8.6190161531953D-02, 9.7618652104114D-02, 1.0744427011597D-01,
     *  1.1550566805373D-01, 1.2167047292780D-01, 1.2583745634683D-01,
     *  1.2793819534675D-01, 7.0186100094701D-03, 1.6274394730906D-02/
      DATA (GW(I), I=58,114)/
     *  2.5392065309262D-02, 3.4273862913021D-02, 4.2835898022227D-02,
     *  5.0998059262376D-02, 5.8684093478536D-02, 6.5822222776362D-02,
     *  7.2345794108849D-02, 7.8193895787070D-02, 8.3311924226947D-02,
     *  8.7652093004404D-02, 9.1173878695764D-02, 9.3844399080805D-02,
     *  9.5638720079275D-02, 9.6540088514728D-02, 3.1533460523058D-03,
     *  7.3275539012763D-03, 1.1477234579235D-02, 1.5579315722944D-02,
     *  1.9616160457356D-02, 2.3570760839324D-02, 2.7426509708357D-02,
     *  3.1167227832798D-02, 3.4777222564770D-02, 3.8241351065831D-02,
     *  4.1545082943465D-02, 4.4674560856694D-02, 4.7616658492490D-02,
     *  5.0359035553854D-02, 5.2890189485194D-02, 5.5199503699984D-02,
     *  5.7277292100403D-02, 5.9114839698396D-02, 6.0704439165894D-02,
     *  6.2039423159893D-02, 6.3114192286254D-02, 6.3924238584648D-02,
     *  6.4466164435950D-02, 6.4737696812684D-02, 1.7832807216964D-03,
     *  4.1470332605625D-03, 6.5044579689784D-03, 8.8467598263639D-03,
     *  1.1168139460131D-02, 1.3463047896719D-02, 1.5726030476025D-02,
     *  1.7951715775697D-02, 2.0134823153530D-02, 2.2270173808383D-02,
     *  2.4352702568711D-02, 2.6377469715055D-02, 2.8339672614259D-02,
     *  3.0234657072402D-02, 3.2057928354852D-02, 3.3805161837142D-02,
     *  3.5472213256882D-02, 3.7055128540240D-02, 3.8550153178616D-02/
      DATA (GW(I), I=115,127)/
     *  3.9953741132720D-02, 4.1262563242624D-02, 4.2473515123654D-02,
     *  4.3583724529323D-02, 4.4590558163757D-02, 4.5491627927418D-02,
     *  4.6284796581314D-02, 4.6968182816210D-02, 4.7540165714830D-02,
     *  4.7999388596458D-02, 4.8344762234803D-02, 4.8575467441503D-02,
     *  4.8690957009140D-02/
C
      IMIN = NP(N)
      IF (IMIN .EQ. 0) RETURN
      XM = (A + B) / 2
      HALFIN = B - XM
      N2 = N / 2
      IMAX = IMIN - 1 + N2
      SUM = 0
      DO 10, I = IMIN, IMAX
      X = HALFIN * GP(I)
   10 SUM = SUM + GW(I) * (F(XM-X) + F(XM+X))
      IF (N .GT. 2*N2) SUM = SUM + GW(IMAX+1) * F(XM)
      Y = SUM * HALFIN
C
      END        
C************************************************************************
